<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Bot Colegio</title>
    <style>
        body { font-family: sans-serif; background: #e5ddd5; display: flex; justify-content: center; height: 100vh; margin: 0; }
        .phone { width: 100%; max-width: 400px; background: #efe7dd; display: flex; flex-direction: column; box-shadow: 0 0 10px rgba(0,0,0,0.2); }
        .header { background: #075e54; color: white; padding: 15px; font-weight: bold; }
        .chat-box { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .message { padding: 10px 15px; border-radius: 10px; max-width: 80%; line-height: 1.4; word-wrap: break-word; white-space: pre-wrap; }
        .bot { background: white; align-self: flex-start; border-top-left-radius: 0; }
        .user { background: #dcf8c6; align-self: flex-end; border-top-right-radius: 0; }
        .input-area { background: #f0f0f0; padding: 10px; display: flex; gap: 10px; }
        input { flex: 1; padding: 10px; border: none; border-radius: 20px; outline: none; }
        button { background: #075e54; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; }
        button:hover { background: #128c7e; }
    </style>
</head>
<body>
    <div class="phone">
        <div class="header">Bot Colegio ðŸŽ“</div>
        <div class="chat-box" id="chatBox"></div>
        <div class="input-area">
            <input type="text" id="userInput" placeholder="EscribÃ­ un mensaje..." onkeypress="handleEnter(event)">
            <button onclick="sendMessage()">Enviar</button>
        </div>
    </div>

    <script>
        const chatBox = document.getElementById('chatBox');
        
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const text = input.value.trim();
            if (!text) return;

            // 1. Mostrar mensaje del usuario
            addMessage(text, 'user');
            input.value = '';

            // 2. Enviar al servidor local
            try {
                const res = await fetch('/chat-local', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text })
                });
                const data = await res.json();
                
                // 3. Mostrar respuesta del bot
                if (data.reply) {
                    addMessage(data.reply, 'bot');
                }
            } catch (err) {
                addMessage("Error de conexiÃ³n con el bot.", 'bot');
            }
        }

        function addMessage(text, sender) {
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            div.textContent = text;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function handleEnter(e) {
            if (e.key === 'Enter') sendMessage();
        }
    </script>
</body>
</html>